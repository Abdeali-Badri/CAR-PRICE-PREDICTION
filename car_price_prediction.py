# -*- coding: utf-8 -*-
"""Car Price Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1bljVU5sajk1BH4seVmpTyrympoQrfeBO
"""

import numpy as np
import pandas as pd

df=pd.read_csv("/content/car data.csv")

df.head()

df.shape

df.info()

df.replace({'Fuel_Type':{'Petrol':0,'Diesel':1,'CNG':2}},inplace=True)
df.replace({'Seller_Type':{'Dealer':0,'Individual':1}},inplace=True)
df.replace({'Transmission':{'Manual':0,'Automatic':1}},inplace=True)

df.head()

X=df.drop(['Car_Name','Selling_Price'],axis=1)
y=df['Selling_Price']

from sklearn.model_selection import train_test_split
X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.1,random_state=2)
print(X.shape,X_train.shape,X_test.shape)

from sklearn.linear_model import LinearRegression
lr=LinearRegression()

lr.fit(X_train,y_train)

from sklearn import metrics

predict=lr.predict(X_train)

error=metrics.r2_score(y_train,predict)
print("The error is :",error)

# Install Hugging Face packages
!pip install huggingface_hub gradio pandas scikit-learn numpy

import pickle
import json
import numpy as np

# Save your trained model
model_filename = 'car_price_predictor.pkl'
with open(model_filename, 'wb') as f:
    pickle.dump(lr, f)

# Save feature names (important for later)
feature_names = list(X.columns)
with open('feature_names.json', 'w') as f:
    json.dump(feature_names, f)

print(f"Model saved as '{model_filename}'")
print(f"Feature names saved: {feature_names}")

from huggingface_hub import login

# Use YOUR token here
login(token="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")

from huggingface_hub import notebook_login

# This will open a login window
notebook_login()

from huggingface_hub import create_repo

# Using YOUR username
your_username = "Abdeali787"  # This is you!
model_name = "car-price-predictor"
repo_id = f"{your_username}/{model_name}"

print(f"üß≠ Creating repository: {repo_id}")

# Create the repository
create_repo(
    repo_id=repo_id,
    repo_type="model",
    private=False,
    exist_ok=True  # If repo exists, won't error
)

print(f"‚úÖ Repository ready: https://huggingface.co/{repo_id}")

from huggingface_hub import HfApi

api = HfApi()

# Upload the model file
api.upload_file(
    path_or_fileobj="car_price_predictor.pkl",
    path_in_repo="car_price_predictor.pkl",
    repo_id=repo_id,
    repo_type="model"
)

# Upload feature names
api.upload_file(
    path_or_fileobj="feature_names.json",
    path_in_repo="feature_names.json",
    repo_id=repo_id,
    repo_type="model"
)

print("‚úÖ Model uploaded successfully!")
print(f"üìÅ View your model at: https://huggingface.co/{repo_id}")

!pip install gradio

import gradio as gr
import pickle
import json
import numpy as np
from huggingface_hub import hf_hub_download

# Load model from Hugging Face
repo_id = "Abdeali787/car-price-predictor"

# Download files
model_path = hf_hub_download(repo_id=repo_id, filename="car_price_predictor.pkl")
features_path = hf_hub_download(repo_id=repo_id, filename="feature_names.json")

# Load model and features
with open(model_path, 'rb') as f:
    model = pickle.load(f)

with open(features_path, 'r') as f:
    feature_names = json.load(f)

def predict_car_price(year, present_price, kms_driven, fuel_type, seller_type, transmission, owner):
    # Prepare input
    input_data = np.array([[
        year,
        present_price,
        kms_driven,
        fuel_type,
        seller_type,
        transmission,
        owner
    ]])

    # Make prediction
    prediction = model.predict(input_data)[0]

    return f"Predicted Selling Price: ‚Çπ{prediction:.2f} Lakhs"

# Create Gradio interface
demo = gr.Interface(
    fn=predict_car_price,
    inputs=[
        gr.Number(label="Manufacturing Year", minimum=2000, maximum=2024),
        gr.Number(label="Present Price (Lakhs)", minimum=1, maximum=100),
        gr.Number(label="Kilometers Driven", minimum=0, maximum=500000),
        gr.Radio([0, 1, 2], label="Fuel Type (0=Petrol, 1=Diesel, 2=CNG)"),
        gr.Radio([0, 1], label="Seller Type (0=Dealer, 1=Individual)"),
        gr.Radio([0, 1], label="Transmission (0=Manual, 1=Automatic)"),
        gr.Number(label="Number of Previous Owners", minimum=0, maximum=3)
    ],
    outputs="text",
    title="üöó Car Price Predictor",
    description="Predict the selling price of a car based on its features",

)

# Launch the app
demo.launch(share=True)  # share=True gives you a public URL